<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MamaRisk - Maternal Health Dashboard</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #5b82c1;
        --primary-light: #7698d0;
        --primary-dark: #3c63a0;
        --secondary: #f0c3c3;
        --secondary-dark: #e6a4a4;
        --danger: #e63946;
        --success: #2a9d8f;
        --warning: #e9c46a;
        --light: #f8f9fa;
        --dark: #212529;
        --gray: #6c757d;
        --sidebar-width: 280px;
        --border-radius: 12px;
        --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f5f7fb;
        color: var(--dark);
        line-height: 1.6;
      }

      .container {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: var(--sidebar-width);
        background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        color: white;
        padding: 25px 0;
        transition: var(--transition);
        box-shadow: var(--box-shadow);
        z-index: 100;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
      }

      .sidebar-header {
        padding: 0 25px 25px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        text-align: center;
        margin-bottom: 20px;
      }

      .sidebar h1 {
        font-size: 1.8rem;
        margin-bottom: 8px;
        font-weight: 700;
        letter-spacing: 1px;
      }

      .sidebar p {
        font-size: 0.9rem;
        opacity: 0.9;
        letter-spacing: 0.5px;
      }

      .nav-menu {
        list-style: none;
        padding: 10px 0;
      }

      .nav-item {
        padding: 14px 25px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        border-left: 4px solid transparent;
        margin-bottom: 5px;
      }

      .nav-item:hover {
        background-color: rgba(255, 255, 255, 0.1);
        border-left: 4px solid rgba(255, 255, 255, 0.5);
      }

      .nav-item.active {
        background-color: rgba(255, 255, 255, 0.2);
        border-left: 4px solid white;
        font-weight: 600;
      }

      .nav-item i {
        margin-right: 12px;
        width: 24px;
        text-align: center;
        font-size: 1.1rem;
      }

      .main-content {
        flex: 1;
        padding: 30px;
        margin-left: var(--sidebar-width);
        transition: var(--transition);
        overflow-y: auto;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e9ecef;
      }

      .header h2 {
        font-size: 1.8rem;
        color: var(--primary-dark);
        font-weight: 600;
      }

      .card {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        padding: 25px;
        margin-bottom: 25px;
        transition: var(--transition);
      }

      .card:hover {
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
      }

      .card h3 {
        color: var(--primary-dark);
        margin-bottom: 20px;
        font-weight: 600;
        font-size: 1.3rem;
      }

      .view {
        display: none;
      }

      .view.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .btn {
        padding: 10px 18px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        letter-spacing: 0.3px;
        text-decoration: none;
      }

      .btn i {
        font-size: 0.9em;
      }

      .btn-primary {
        background-color: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
      }

      .btn-danger {
        background-color: var(--danger);
        color: white;
      }

      .btn-danger:hover {
        background-color: #c62f3b;
        transform: translateY(-2px);
      }

      .btn-success {
        background-color: var(--success);
        color: white;
      }

      .btn-success:hover {
        background-color: #238b7e;
        transform: translateY(-2px);
      }

      .btn-warning {
        background-color: var(--warning);
        color: var(--dark);
      }

      .btn-warning:hover {
        background-color: #d6b35c;
        transform: translateY(-2px);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--dark);
      }

      .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 15px;
        transition: var(--transition);
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(91, 130, 193, 0.2);
      }

      .row {
        display: flex;
        flex-wrap: wrap;
        margin: 0 -12px;
      }

      .col {
        flex: 1;
        padding: 0 12px;
        min-width: 250px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      table th,
      table td {
        padding: 14px 12px;
        text-align: left;
        border-bottom: 1px solid #eef0f5;
      }

      table th {
        background-color: #f8f9fa;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--primary-dark);
      }

      table tr:hover {
        background-color: #f8f9fa;
      }

      .risk-high {
        color: var(--danger);
        font-weight: bold;
      }

      .risk-medium {
        color: var(--warning);
        font-weight: bold;
      }

      .risk-low {
        color: var(--success);
        font-weight: bold;
      }

      .action-buttons {
        display: flex;
        gap: 8px;
      }

      .stats-container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        flex: 1;
        min-width: 220px;
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        padding: 25px;
        text-align: center;
        transition: var(--transition);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background-color: var(--primary);
      }

      .stat-card h3 {
        font-size: 2.8rem;
        font-weight: bold;
        margin-bottom: 5px;
        transition: var(--transition);
      }

      .stat-card p {
        color: var(--gray);
        font-size: 1rem;
        font-weight: 500;
      }

      .stat-total::before {
        background-color: var(--primary);
      }
      .stat-high::before {
        background-color: var(--danger);
      }
      .stat-medium::before {
        background-color: var(--warning);
      }
      .stat-low::before {
        background-color: var(--success);
      }

      .stat-total h3 {
        color: var(--primary);
      }
      .stat-high h3 {
        color: var(--danger);
      }
      .stat-medium h3 {
        color: var(--warning);
      }
      .stat-low h3 {
        color: var(--success);
      }

      .search-bar {
        display: flex;
        margin-bottom: 25px;
      }

      .search-bar input {
        flex: 1;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px 0 0 8px;
        font-size: 15px;
        transition: var(--transition);
      }

      .search-bar input:focus {
        outline: none;
        border-color: var(--primary);
      }

      .search-bar button {
        background-color: var(--primary);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 0 8px 8px 0;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
      }

      .search-bar button:hover {
        background-color: var(--primary-dark);
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        overflow: auto;
        backdrop-filter: blur(5px);
        animation: fadeIn 0.3s ease;
      }

      .modal-content {
        background-color: white;
        margin: 6% auto;
        padding: 30px;
        width: 50%;
        max-width: 600px;
        border-radius: var(--border-radius);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        animation: slideDown 0.4s ease;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #eef0f5;
        padding-bottom: 15px;
        margin-bottom: 25px;
      }

      .modal-header h3 {
        margin: 0;
        color: var(--primary-dark);
        font-size: 1.4rem;
      }

      .close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: var(--transition);
      }

      .close:hover {
        color: var(--primary-dark);
      }

      .alert {
        padding: 16px;
        margin-bottom: 20px;
        border-radius: 8px;
        border-left: 4px solid;
        animation: slideIn 0.3s ease;
        position: relative;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border-left-color: var(--danger);
      }

      .alert-success {
        background-color: #d4edda;
        color: #155724;
        border-left-color: var(--success);
      }

      .alert-warning {
        background-color: #fff3cd;
        color: #856404;
        border-left-color: var(--warning);
      }

      .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
        margin-bottom: 20px;
      }

      /* Dark Mode Styles */
      body.dark-mode {
        background-color: #1a1a1a;
        color: #ffffff;
      }

      .dark-mode .card {
        background-color: #2d2d2d;
        color: #ffffff;
      }

      .dark-mode table th {
        background-color: #333333;
      }

      .dark-mode .form-control {
        background-color: #333;
        color: #fff;
        border-color: #444;
      }

      .dark-mode .stat-card {
        background-color: #333;
      }

      .dark-mode .post h4 {
        color: var(--primary-light);
      }

      .dark-mode .comment {
        background: #333;
      }

      /* Community Post Styles */
      .post {
        padding: 15px;
        border-bottom: 1px solid #eee;
      }

      .post h4 {
        margin-bottom: 10px;
        color: var(--primary-dark);
      }

      .comments {
        margin: 10px 0;
        padding-left: 20px;
        border-left: 2px solid var(--primary-light);
      }

      .comment {
        margin: 8px 0;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 6px;
      }

      /* Responsive Styles */
      @media screen and (max-width: 1024px) {
        .stats-container,
        .row {
          flex-direction: column;
        }

        .col {
          width: 100%;
          margin-bottom: 15px;
        }

        .stat-card {
          width: 100%;
        }
      }

      @media screen and (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
          position: fixed;
          top: 0;
          bottom: 0;
          width: 80%;
          max-width: 300px;
          z-index: 1000;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          padding: 20px;
        }

        .toggle-menu {
          display: block;
        }

        .modal-content {
          width: 90%;
          margin: 10% auto;
          padding: 20px;
        }

        .row {
          margin: 0;
        }

        .col {
          padding: 0;
        }

        table {
          display: block;
          overflow-x: auto;
          white-space: nowrap;
        }

        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }

        .header > div {
          width: 100%;
        }

        .btn {
          width: 100%;
        }
        /* Risk Assessment Additional Styles */

        /* Risk Level Indicators */
        .risk-indicator {
          display: inline-flex;
          align-items: center;
          padding: 5px 10px;
          border-radius: 50px;
          font-weight: bold;
          margin-right: 10px;
        }

        .risk-indicator i {
          margin-right: 5px;
        }

        .risk-indicator.high {
          background-color: rgba(230, 57, 70, 0.1);
          color: var(--danger);
          border: 1px solid var(--danger);
        }

        .risk-indicator.medium {
          background-color: rgba(233, 196, 106, 0.1);
          color: var(--warning);
          border: 1px solid var(--warning);
        }

        .risk-indicator.low {
          background-color: rgba(42, 157, 143, 0.1);
          color: var(--success);
          border: 1px solid var(--success);
        }

        /* Risk Assessment Result Card */
        .risk-result-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 15px;
          padding-bottom: 15px;
          border-bottom: 1px solid #eee;
        }

        .risk-value {
          font-size: 3rem;
          font-weight: bold;
          margin: 15px 0;
          text-align: center;
        }

        .risk-high .risk-value {
          color: var(--danger);
        }

        .risk-medium .risk-value {
          color: var(--warning);
        }

        .risk-low .risk-value {
          color: var(--success);
        }

        /* Probability bars */
        .probability-bar {
          margin-bottom: 15px;
        }

        .probability-bar-header {
          display: flex;
          justify-content: space-between;
          margin-bottom: 5px;
        }

        .probability-bar-track {
          height: 8px;
          width: 100%;
          background-color: #f4f4f4;
          border-radius: 4px;
          overflow: hidden;
        }

        .probability-bar-fill {
          height: 100%;
          border-radius: 4px;
          transition: width 0.5s ease;
        }

        .probability-bar-fill.high {
          background-color: var(--danger);
        }

        .probability-bar-fill.medium {
          background-color: var(--warning);
        }

        .probability-bar-fill.low {
          background-color: var(--success);
        }

        /* Recommendation panels */
        .recommendation-panel {
          margin-top: 20px;
          padding: 15px;
          border-radius: 8px;
          border-left: 4px solid;
        }

        .recommendation-panel.high {
          background-color: rgba(230, 57, 70, 0.05);
          border-left-color: var(--danger);
        }

        .recommendation-panel.medium {
          background-color: rgba(233, 196, 106, 0.05);
          border-left-color: var(--warning);
        }

        .recommendation-panel.low {
          background-color: rgba(42, 157, 143, 0.05);
          border-left-color: var(--success);
        }

        .recommendation-panel h4 {
          margin-bottom: 10px;
          color: var(--dark);
        }

        .recommendation-panel ul {
          padding-left: 20px;
          margin-bottom: 0;
        }

        .recommendation-panel li {
          margin-bottom: 5px;
        }

        /* History items */
        .history-item {
          padding: 15px;
          border-bottom: 1px solid #eee;
          transition: background-color 0.2s;
        }

        .history-item:hover {
          background-color: #f9f9f9;
        }

        .history-item-date {
          font-size: 0.85rem;
          color: var(--gray);
        }

        .history-item-risk {
          font-weight: 600;
        }

        /* Vital signs table */
        .vitals-table {
          width: 100%;
          border-collapse: collapse;
          margin: 15px 0;
        }

        .vitals-table th,
        .vitals-table td {
          padding: 10px;
          border-bottom: 1px solid #eee;
        }

        .vitals-table th {
          text-align: left;
          font-weight: 600;
          color: var(--gray);
        }

        .abnormal-value {
          color: var(--danger);
          font-weight: 600;
        }

        /* Modal for historical assessments */
        .history-modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5);
          overflow: auto;
        }

        .history-modal-content {
          background-color: #fff;
          margin: 10% auto;
          padding: 20px;
          width: 70%;
          max-width: 700px;
          border-radius: var(--border-radius);
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
          animation: fadeIn 0.3s;
        }

        /* Dark mode adjustments */
        .dark-mode .probability-bar-track {
          background-color: rgba(255, 255, 255, 0.1);
        }

        .dark-mode .history-item:hover {
          background-color: rgba(255, 255, 255, 0.05);
        }

        .dark-mode .vitals-table th,
        .dark-mode .vitals-table td {
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dark-mode .recommendation-panel.high {
          background-color: rgba(230, 57, 70, 0.1);
        }

        .dark-mode .recommendation-panel.medium {
          background-color: rgba(233, 196, 106, 0.1);
        }

        .dark-mode .recommendation-panel.low {
          background-color: rgba(42, 157, 143, 0.1);
        }
      }
    </style>
  </head>
  <body>
    <button class="toggle-menu" id="toggle-menu">
      <i class="fas fa-bars"></i>
    </button>

    <div class="container">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h1>MamaRisk</h1>
          <p>Maternal Health Dashboard</p>
        </div>
        <ul class="nav-menu">
          <li class="nav-item active" data-view="dashboard-view">
            <i class="fas fa-chart-line"></i> Dashboard
          </li>
          <li class="nav-item" data-view="patients-view">
            <i class="fas fa-users"></i> Patients
          </li>
          <li class="nav-item" data-view="vitals-view">
            <i class="fas fa-heartbeat"></i> Risk Assessment
          </li>
          <li class="nav-item" data-view="antenatal-view">
            <i class="fas fa-calendar-check"></i> Antenatal Visits
          </li>
          <li class="nav-item" data-view="analytics-view">
            <i class="fas fa-chart-bar"></i> Analytics
          </li>
          <li class="nav-item" data-view="community-view">
            <i class="fas fa-comments"></i> Community
          </li>
        </ul>

        <div class="theme-switch" id="theme-switch">
          <i class="fas fa-moon"></i> Dark Mode
        </div>
      </aside>

      <main class="main-content">
        <!-- Dashboard View -->
        <div id="dashboard-view" class="view active">
          <div class="header">
            <h2>Dashboard</h2>
            <div>
              <button class="btn btn-primary" id="refresh-stats"
                ><i class="fas fa-sync-alt"></i> Refresh Stats</button
              >
            </div>
          </div>

          <div class="stats-container">
            <div class="stat-card stat-total">
              <h3 id="total-cases">254</h3>
              <p>Total Cases</p>
            </div>
            <div class="stat-card stat-high">
              <h3 id="high-risk">37</h3>
              <p>High Risk</p>
            </div>
            <div class="stat-card stat-medium">
              <h3 id="medium-risk">68</h3>
              <p>Medium Risk</p>
            </div>
            <div class="stat-card stat-low">
              <h3 id="low-risk">149</h3>
              <p>Low Risk</p>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <div class="card">
                <h3>Risk Distribution</h3>
                <div class="chart-container">
                  <canvas id="riskChart"></canvas>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card">
                <h3>Recent Assessments</h3>
                <div class="chart-container">
                  <canvas id="weeklyAssessmentsChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>Recent Risk Assessments</h3>
            <div id="recent-assessments">
              <table>
                <thead>
                  <tr>
                    <th>National ID</th>
                    <th>Name</th>
                    <th>Date</th>
                    <th>Risk Level</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="recent-assessments-body">
                  <!-- Data from API -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Patients View -->
        <div id="patients-view" class="view">
          <div class="header">
            <h2>Patient Management</h2>
            <div>
              <button class="btn btn-primary" id="add-patient-btn"
                ><i class="fas fa-user-plus"></i> Add New Patient</button
              >
            </div>
          </div>

          <div class="search-bar">
            <input
              type="text"
              id="patient-search"
              placeholder="Search by National ID or Name..."
            />
            <button id="search-btn"><i class="fas fa-search"></i> Search</button>
          </div>

          <div class="card">
            <table>
              <thead>
                <tr>
                  <th>National ID</th>
                  <th>Name</th>
                  <th>Age</th>
                  <th>Contact</th>
                  <th>Last Visit</th>
                  <th>Risk Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="patients-table-body">
                <!-- Data from API -->
              </tbody>
            </table>
          </div>
        </div>
        <!-- Add Patient Modal -->
        <div id="add-patient-modal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h3>Add New Patient</h3>
              <span class="close">&times;</span>
            </div>
            <form id="add-patient-form">
              <div class="form-group">
                <label for="new-national-id">National ID</label>
                <input type="text" id="new-national-id" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="new-first-name">First Name</label>
                <input type="text" id="new-first-name" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="new-last-name">Last Name</label>
                <input type="text" id="new-last-name" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="new-age">Age</label>
                <input type="number" id="new-age" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="new-phone">Phone Number</label>
                <input type="tel" id="new-phone" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="new-address">Address</label>
                <textarea id="new-address" class="form-control" rows="2"></textarea>
              </div>
              <button type="submit" class="btn btn-primary">Add Patient</button>
            </form>
          </div>
        </div>

        <!-- Risk Assessment View with Enhanced Result Display and Historical Predictions -->
        <div id="vitals-view" class="view">
          <div class="header">
            <h2>Risk Assessment</h2>
          </div>

          <div class="card">
            <form id="risk-assessment-form">
              <div class="form-group">
                <label for="national-id">National ID</label>
                <input type="text" id="national-id" class="form-control" required />
              </div>

              <div class="row">
                <div class="col form-group">
                  <label for="age">Age</label>
                  <input type="number" id="age" class="form-control" required />
                </div>
                <div class="col form-group">
                  <label for="systolic-bp">Systolic BP (mmHg)</label>
                  <input type="number" id="systolic-bp" class="form-control" required />
                </div>
                <div class="col form-group">
                  <label for="diastolic-bp">Diastolic BP (mmHg)</label>
                  <input type="number" id="diastolic-bp" class="form-control" required />
                </div>
              </div>

              <div class="row">
                <div class="col form-group">
                  <label for="blood-sugar">Blood Sugar (mmol/L)</label>
                  <input
                    type="number"
                    id="blood-sugar"
                    class="form-control"
                    step="0.1"
                    required
                  />
                </div>
                <div class="col form-group">
                  <label for="body-temp">Body Temperature (°F)</label>
                  <input
                    type="number"
                    id="body-temp"
                    class="form-control"
                    step="0.1"
                    required
                  />
                </div>
                <div class="col form-group">
                  <label for="heart-rate">Heart Rate (bpm)</label>
                  <input type="number" id="heart-rate" class="form-control" required />
                </div>
              </div>

              <button type="submit" class="btn btn-primary"
                ><i class="fas fa-calculator"></i> Predict Risk</button
              >
            </form>
          </div>

          <!-- Enhanced Risk Result Card -->
          <div id="risk-result" class="card" style="display: none">
            <!-- This content will be dynamically filled by JavaScript -->
          </div>

          <!-- New Historical Predictions Card -->
          <div id="prediction-history" class="card" style="display: none">
            <h3>Previous Risk Assessments</h3>
            <div id="history-content">
              <!-- This content will be dynamically filled by JavaScript -->
            </div>
          </div>
        </div>
        <!-- Antenatal Visits View -->
        <div id="antenatal-view" class="view">
          <div class="header">
            <h2>Antenatal Visits</h2>
            <div>
              <button class="btn btn-primary" id="add-visit-btn"
                ><i class="fas fa-plus"></i> Add Visit</button
              >
            </div>
          </div>

          <div class="card">
            <div class="calendar-container" id="calendar"></div>
          </div>

          <div class="card">
            <h3>Upcoming Appointments</h3>
            <table id="upcoming-visits">
              <thead>
                <tr>
                  <th>Patient</th>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody><!-- Fetched from API --></tbody>
            </table>
          </div>
        </div>

        <!-- Analytics View -->
        <div id="analytics-view" class="view">
          <div class="header">
            <h2>Advanced Analytics</h2>
          </div>

          <div class="row">
            <div class="col">
              <div class="card">
                <h3>Risk Trends</h3>
                <div class="chart-container">
                  <canvas id="trendChart"></canvas>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card">
                <h3>Demographic Distribution</h3>
                <div class="chart-container">
                  <canvas id="demographicChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Community View -->
        <div id="community-view" class="view">
          <div class="header">
            <h2>Community Platform</h2>
            <div>
              <button class="btn btn-primary" id="new-post-btn"
                ><i class="fas fa-plus"></i> New Post</button
              >
            </div>
          </div>

          <div class="card">
            <div class="posts-container">
              <!-- Posts will be loaded here -->
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
             // Main JavaScript for MamaRisk Dashboard
      document.addEventListener('DOMContentLoaded', () => {
          // Configuration
          const API_BASE = 'http://localhost:8000'; // Ensure this matches your backend server

          // DOM Elements
          const addPatientBtn = document.getElementById('add-patient-btn');
          const addPatientModal = document.getElementById('add-patient-modal');
          const addPatientForm = document.getElementById('add-patient-form');
          const riskAssessmentForm = document.getElementById('risk-assessment-form');
          const riskResult = document.getElementById('risk-result');
          const searchBtn = document.getElementById('search-btn');
          const patientSearch = document.getElementById('patient-search');
          const closeButtons = document.querySelectorAll('.close');
          const refreshStatsBtn = document.getElementById('refresh-stats');

          let currentView = 'dashboard-view';

          // ============ Error / Success Handling ============

          function showAlert(message, type = 'info') {
              // Create alert element
              const alertDiv = document.createElement('div');
              alertDiv.className = `alert alert-${type}`;
              alertDiv.textContent = message;

              // Add to page
              document.querySelector('.main-content').prepend(alertDiv);

              // Auto-remove after 5 seconds
              setTimeout(() => {
                  alertDiv.style.opacity = '0';
                  setTimeout(() => alertDiv.remove(), 300);
              }, 5000);
          }

          // ============ Navigation ============

          // Navigation between views
          const navItems = document.querySelectorAll('.nav-item');
          const views = document.querySelectorAll('.view');

          function showView(viewId) {
              views.forEach(view => view.classList.remove('active'));
              navItems.forEach(item => item.classList.remove('active'));
              document.getElementById(viewId).classList.add('active');
              document.querySelector(`[data-view="${viewId}"]`).classList.add('active');
              currentView = viewId;

              // Load data based on the view
              if (viewId === 'patients-view') {
                  fetchPatients();
              } else if (viewId === 'dashboard-view') {
                  fetchDashboardStats();
                  fetchRecentAssessments();
              }
          }

          navItems.forEach(item => {
              item.addEventListener('click', (e) => {
                  e.preventDefault();
                  const viewId = item.dataset.view;
                  if(viewId !== currentView) showView(viewId);
              });
          });

          // Dark Mode Toggle
          document.getElementById('theme-switch').addEventListener('click', () => {
              document.body.classList.toggle('dark-mode');
              localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
          });

          // Initialize theme from local storage
          const savedTheme = localStorage.getItem('theme');
          if (savedTheme === 'dark') document.body.classList.add('dark-mode');

          // Mobile Menu Toggle
          const sidebar = document.getElementById('sidebar');
          document.getElementById('toggle-menu').addEventListener('click', () => {
              sidebar.classList.toggle('active');
          });

          // Close modals
          closeButtons.forEach(button => {
              button.addEventListener('click', () => {
                  const modal = button.closest('.modal');
                  if (modal) modal.style.display = 'none';
              });
          });

          // ============ Dashboard Functions ============

          async function fetchDashboardStats() {
              try {
                  // In a real app, you would fetch this from an API endpoint
                  // For now we'll use the static data
                  document.getElementById('total-cases').textContent = '254';
                  document.getElementById('high-risk').textContent = '37';
                  document.getElementById('medium-risk').textContent = '68';
                  document.getElementById('low-risk').textContent = '149';

                  // Initialize charts
                  initRiskChart();
                  initWeeklyAssessmentsChart();

              } catch (error) {
                  showAlert('Failed to load dashboard statistics', 'danger');
                  console.error('Dashboard stats error:', error);
              }
          }

          // Initialize Risk Distribution Chart
          function initRiskChart() {
              const ctx = document.getElementById('riskChart').getContext('2d');
              new Chart(ctx, {
                  type: 'pie',
                  data: {
                      labels: ['Low Risk', 'Medium Risk', 'High Risk'],
                      datasets: [{
                          data: [149, 68, 37],
                          backgroundColor: [
                              '#2a9d8f', // Low - Success
                              '#e9c46a', // Medium - Warning
                              '#e63946'  // High - Danger
                          ],
                          borderWidth: 1
                      }]
                  },
                  options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                          legend: {
                              position: 'bottom',
                          }
                      }
                  }
              });
          }

          // Initialize Weekly Assessments Chart
          function initWeeklyAssessmentsChart() {
              const ctx = document.getElementById('weeklyAssessmentsChart').getContext('2d');
              new Chart(ctx, {
                  type: 'bar',
                  data: {
                      labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                      datasets: [{
                          label: 'Assessments',
                          data: [12, 9, 15, 8, 11, 7, 4],
                          backgroundColor: '#5B82C1',
                          borderWidth: 1,
                          barThickness: 20,
                          borderRadius: 4
                      }]
                  },
                  options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      scales: {
                          y: {
                              beginAtZero: true,
                              ticks: {
                                  precision: 0
                              }
                          }
                      }
                  }
              });
          }

          // Fetch Recent Risk Assessments for Dashboard
          async function fetchRecentAssessments() {
              try {
                  // In production, you would fetch from an API endpoint
                  // For now, we'll use mock data
                  const mockData = [
                      { id: '123', national_id: '1234567890', name: 'Jane Doe', date: '2025-05-15', risk: 'High' },
                      { id: '124', national_id: '2345678901', name: 'Mary Smith', date: '2025-05-14', risk: 'Low' },
                      { id: '125', national_id: '3456789012', name: 'Susan Johnson', date: '2025-05-13', risk: 'Medium' }
                  ];

                  const tbody = document.getElementById('recent-assessments-body');
                  tbody.innerHTML = mockData.map(assessment => `
                      <tr>
                          <td>${assessment.national_id}</td>
                          <td>${assessment.name}</td>
                          <td>${assessment.date}</td>
                          <td><span class="risk-${assessment.risk.toLowerCase()}">${assessment.risk}</span></td>
                          <td>
                              <div class="action-buttons">
                                  <button class="btn btn-primary view-assessment" data-id="${assessment.id}">
                                      <i class="fas fa-eye"></i>
                                  </button>
                              </div>
                          </td>
                      </tr>
                  `).join('');

              } catch (error) {
                  showAlert('Failed to load recent assessments', 'danger');
                  console.error('Recent assessments error:', error);
              }
          }

          // ============ Patient Management ============

          // Open Add Patient Modal
          if (addPatientBtn) {
              addPatientBtn.addEventListener('click', () => {
                  addPatientModal.style.display = 'block';
              });
          }

          // Add Patient Form Submission
          if (addPatientForm) {
              addPatientForm.addEventListener('submit', async (e) => {
                  e.preventDefault();

                  try {
                      const patientData = {
                          national_id: document.getElementById('new-national-id').value,
                          full_name: `${document.getElementById('new-first-name').value} ${document.getElementById('new-last-name').value}`,
                          age: parseInt(document.getElementById('new-age').value),
                          phone_primary: document.getElementById('new-phone').value,
                          address: document.getElementById('new-address').value
                      };

                      const response = await fetch(`${API_BASE}/patients/`, {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify(patientData)
                      });

                      if (!response.ok) {
                          const errorData = await response.json();
                          throw new Error(errorData.detail || 'Failed to add patient');
                      }

                      showAlert('Patient added successfully', 'success');
                      addPatientModal.style.display = 'none';
                      addPatientForm.reset();
                      fetchPatients();

                  } catch (error) {
                      showAlert(error.message, 'danger');
                      console.error('Add patient error:', error);
                  }
              });
          }

          // Fetch Patients List
          async function fetchPatients() {
              try {
                  const response = await fetch(`${API_BASE}/patients/`);

                  if (!response.ok) {
                      throw new Error('Failed to fetch patients data');
                  }

                  const patients = await response.json();
                  const tbody = document.getElementById('patients-table-body');

                  if (!tbody) {
                      console.error('Patients table body element not found');
                      return;
                  }

                  tbody.innerHTML = patients.map(patient => {
                      // Calculate risk level from latest prediction if available
                      let riskLevel = 'Unknown';
                      if (patient.prediction_history && patient.prediction_history.length) {
                          const latestPrediction = patient.prediction_history[patient.prediction_history.length - 1];
                          riskLevel = latestPrediction.risk || 'Unknown';
                      }

                      // Format date or use placeholder
                      const lastVisit = patient.updated_at ? new Date(patient.updated_at).toLocaleDateString() : 'Never';

                      return `
                          <tr>
                              <td>${patient.national_id}</td>
                              <td>${patient.full_name}</td>
                              <td>${patient.age || 'N/A'}</td>
                              <td>${patient.phone_primary || 'N/A'}</td>
                              <td>${lastVisit}</td>
                              <td><span class="risk-${riskLevel.toLowerCase()}">${riskLevel}</span></td>
                              <td>
                                  <div class="action-buttons">
                                      <button class="btn btn-primary view-btn" data-id="${patient.id}">
                                          <i class="fas fa-eye"></i>
                                      </button>
                                      <button class="btn btn-success edit-btn" data-id="${patient.id}">
                                          <i class="fas fa-edit"></i>
                                      </button>
                                      <button class="btn btn-danger delete-btn" data-id="${patient.id}">
                                          <i class="fas fa-trash"></i>
                                      </button>
                                  </div>
                              </td>
                          </tr>
                      `;
                  }).join('');

                  // Add event listeners to action buttons
                  document.querySelectorAll('.delete-btn').forEach(btn => {
                      btn.addEventListener('click', async () => {
                          if (confirm('Are you sure you want to delete this patient?')) {
                              try {
                                  const response = await fetch(`${API_BASE}/patients/${btn.dataset.id}`, {
                                      method: 'DELETE'
                                  });

                                  if (!response.ok) {
                                      throw new Error('Failed to delete patient');
                                  }

                                  showAlert('Patient deleted successfully', 'success');
                                  fetchPatients();
                              } catch (error) {
                                  showAlert(error.message, 'danger');
                                  console.error('Delete patient error:', error);
                              }
                          }
                      });
                  });

              } catch (error) {
                  showAlert('Failed to load patients data', 'danger');
                  console.error('Fetch patients error:', error);
              }
          }

          // Patient Search
          if (searchBtn && patientSearch) {
              searchBtn.addEventListener('click', () => {
                  const searchTerm = patientSearch.value.toLowerCase();
                  const rows = document.querySelectorAll('#patients-table-body tr');

                  rows.forEach(row => {
                      const id = row.querySelector('td:first-child').textContent.toLowerCase();
                      const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();

                      if (id.includes(searchTerm) || name.includes(searchTerm)) {
                          row.style.display = '';
                      } else {
                          row.style.display = 'none';
                      }
                  });
              });
          }

          // Update community view JavaScript
          async function loadCommunityPosts() {
            try {
                const response = await fetch('/api/community/posts');
                const posts = await response.json();
                renderPosts(posts);
          }     catch (error) {
              showError('Failed to load community posts');
          }
      }

          async function submitPost(postData) {
              try {
                  const response = await fetch('/api/community/posts', {
                   method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                      'Authorization': `Bearer ${getAuthToken()}`
                  },
                  body: JSON.stringify(postData)
              });
                  if (!response.ok) throw new Error('Post failed');
              loadCommunityPosts();
          }       catch (error) {
              showError(error.message);
          }
      }
          // Add to both dashboard scripts
        function setupCommunity() {
          // Shared event listeners
            document.getElementById('new-post-btn').addEventListener('click', showPostModal);
            document.querySelectorAll('.comment-form').forEach(form => {
              form.addEventListener('submit', handleCommentSubmit);
          });

          // Initial load
            loadCommunityPosts();
      }
          // ============ Risk Assessment ============

          // Risk Assessment Form Submission
          if (riskAssessmentForm) {
              riskAssessmentForm.addEventListener('submit', async (e) => {
                  e.preventDefault();
                  const submitBtn = e.target.querySelector('button[type="submit"]');

                  try {
                      // Get form values - ensure ID attributes match your HTML
                      const values = {
                          national_id: document.getElementById('national-id').value.trim(),
                          Age: parseInt(document.getElementById('age').value),
                          SystolicBP: parseInt(document.getElementById('systolic-bp').value),
                          DiastolicBP: parseInt(document.getElementById('diastolic-bp').value),
                          BS: parseFloat(document.getElementById('blood-sugar').value),
                          BodyTemp: parseFloat(document.getElementById('body-temp').value),
                          HeartRate: parseInt(document.getElementById('heart-rate').value)
                      };

                      // Validate input
                      for (const [key, value] of Object.entries(values)) {
                          if (key !== 'national_id' && (isNaN(value) || value <= 0)) {
                              throw new Error(`Invalid value for ${key}`);
                          }
                      }

                      submitBtn.disabled = true;
                      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';

                      const response = await fetch(`${API_BASE}/predict/`, {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify(values)
                      });

                      if (!response.ok) {
                          const errorData = await response.json();
                          throw new Error(errorData.detail || 'Risk assessment failed');
                      }

                      const result = await response.json();

                      // Display the result
                      riskResult.style.display = 'block';
                      riskResult.innerHTML = `
                          <h3>Risk Assessment Result</h3>
                          <div style="padding: 20px; text-align: center;">
                              <h4>Risk Classification</h4>
                              <div style="font-size: 2rem; margin: 20px 0; font-weight: bold;" class="risk-${result.prediction.toLowerCase()}">
                                  ${result.prediction}
                              </div>
                              <p>Confidence: ${result.confidence}%</p>
                              <div class="action-buttons" style="justify-content: center; margin-top: 20px;">
                                  <button class="btn btn-primary" id="save-assessment">
                                      <i class="fas fa-save"></i> Save Assessment
                                  </button>
                                  <button class="btn btn-warning" id="new-assessment">
                                      <i class="fas fa-plus"></i> New Assessment
                                  </button>
                              </div>
                          </div>
                      `;

                      // Scroll to result
                      window.scrollTo({ top: riskResult.offsetTop - 20, behavior: 'smooth' });

                      // Add event listener for new assessment button
                      document.getElementById('new-assessment').addEventListener('click', () => {
                          riskAssessmentForm.reset();
                          riskResult.style.display = 'none';
                      });

                  } catch (error) {
                      showAlert(error.message, 'danger');
                      console.error('Risk assessment error:', error);
                  } finally {
                      submitBtn.disabled = false;
                      submitBtn.innerHTML = '<i class="fas fa-calculator"></i> Predict Risk';
                  }
              });
          }
          // Risk Assessment JavaScript Functionality

      // Risk Assessment Form Submission
      if (riskAssessmentForm) {
          riskAssessmentForm.addEventListener('submit', async (e) => {
              e.preventDefault();
              const submitBtn = e.target.querySelector('button[type="submit"]');
              const nationalIdInput = document.getElementById('national-id');

              try {
                  // Get form values
                  const values = {
                      national_id: nationalIdInput.value.trim(),
                      Age: parseInt(document.getElementById('age').value),
                      SystolicBP: parseInt(document.getElementById('systolic-bp').value),
                      DiastolicBP: parseInt(document.getElementById('diastolic-bp').value),
                      BS: parseFloat(document.getElementById('blood-sugar').value),
                      BodyTemp: parseFloat(document.getElementById('body-temp').value),
                      HeartRate: parseInt(document.getElementById('heart-rate').value)
                  };

                  // Validate input
                  for (const [key, value] of Object.entries(values)) {
                      if (key !== 'national_id' && (isNaN(value) || value <= 0)) {
                          throw new Error(`Invalid value for ${key}`);
                      }
                  }

                  submitBtn.disabled = true;
                  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';

                  const response = await fetch(`${API_BASE}/predict/`, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify(values)
                  });

                  if (!response.ok) {
                      const errorData = await response.json();
                      throw new Error(errorData.detail || 'Risk assessment failed');
                  }

                  const result = await response.json();

                  // Display the enhanced result
                  displayRiskResult(result);

                  // Fetch and display prediction history
                  await fetchPredictionHistory(values.national_id);

              } catch (error) {
                  showAlert(error.message, 'danger');
                  console.error('Risk assessment error:', error);
              } finally {
                  submitBtn.disabled = false;
                  submitBtn.innerHTML = '<i class="fas fa-calculator"></i> Predict Risk';
              }
          });
      }

      // Function to display enhanced risk result
      function displayRiskResult(result) {
          const riskResult = document.getElementById('risk-result');
          if (!riskResult) return;

          // Get risk level class
          const riskClass = result.prediction.toLowerCase();

          // Format probabilities for low, medium, high risks
          const probabilities = result.probabilities;
          let probabilityLabels = ['Low Risk', 'Medium Risk', 'High Risk'];

          // If the model returns probabilities in different order, adjust this mapping
          // based on label_encoder's classes_ attribute

          // Create probability bars
          const probabilityBars = probabilities.map((prob, index) => {
              const percentage = Math.round(prob * 100);
              const label = probabilityLabels[index];
              let barColor = '#2a9d8f'; // Low risk
              if (index === 1) barColor = '#e9c46a'; // Medium risk
              if (index === 2) barColor = '#e63946'; // High risk

              return `
                  <div style="margin-bottom: 10px;">
                      <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                          <span>${label}</span>
                          <span>${percentage}%</span>
                      </div>
                      <div style="height: 8px; width: 100%; background-color: #eee; border-radius: 4px; overflow: hidden;">
                          <div style="height: 100%; width: ${percentage}%; background-color: ${barColor}; border-radius: 4px;"></div>
                      </div>
                  </div>
              `;
          }).join('');

          // Define risk level messages
          const riskMessages = {
              'high': `
                  <div class="alert alert-danger">
                      <strong>Critical Attention Required:</strong> Several significant risk factors detected.
                      Immediate medical consultation is recommended.
                  </div>
                  <ul>
                      <li>Schedule an urgent appointment with a healthcare provider</li>
                      <li>Monitor blood pressure regularly</li>
                      <li>Watch for warning signs such as severe headache, visual disturbances, or swelling</li>
                  </ul>
              `,
              'medium': `
                  <div class="alert alert-warning">
                      <strong>Increased Vigilance Needed:</strong> Some risk factors detected that require attention.
                      Regular monitoring is recommended.
                  </div>
                  <ul>
                      <li>Plan for more frequent check-ups</li>
                      <li>Monitor your symptoms and vital signs</li>
                      <li>Follow dietary and rest recommendations</li>
                  </ul>
              `,
              'low': `
                  <div class="alert alert-success">
                      <strong>Standard Care Appropriate:</strong> Your vitals indicate lower risk.
                      Continue with regular prenatal care.
                  </div>
                  <ul>
                      <li>Maintain regular prenatal check-ups</li>
                      <li>Continue following nutrition and exercise guidelines</li>
                      <li>Report any changes in symptoms to your healthcare provider</li>
                  </ul>
              `
          };

          // Display detailed result
          riskResult.style.display = 'block';
          riskResult.innerHTML = `
              <h3>Risk Assessment Result</h3>
              <div class="row">
                  <div class="col" style="text-align: center; padding: 20px;">
                      <h4>Risk Classification</h4>
                      <div style="font-size: 2.5rem; margin: 20px 0; font-weight: bold;" class="risk-${riskClass}">
                          ${result.prediction} Risk
                      </div>
                      <p>Model Confidence: <strong>${result.confidence}%</strong></p>
                      <div class="model-info" style="margin-top: 15px; font-style: italic; font-size: 0.9rem;">
                          <p>Prediction made using XGBoost AI model</p>
                          <p>Date: ${new Date().toLocaleString()}</p>
                      </div>
                  </div>
                  <div class="col">
                      <h4>Risk Probability Distribution</h4>
                      <div style="margin-top: 15px;">
                          ${probabilityBars}
                      </div>
                      <div style="margin-top: 20px;">
                          ${riskMessages[riskClass] || ''}
                      </div>
                  </div>
              </div>
              <div class="action-buttons" style="justify-content: center; margin-top: 20px;">
                  <button class="btn btn-primary" id="save-assessment">
                      <i class="fas fa-save"></i> Save Assessment
                  </button>
                  <button class="btn btn-warning" id="new-assessment">
                      <i class="fas fa-plus"></i> New Assessment
                  </button>
                  <button class="btn btn-success" id="print-assessment">
                      <i class="fas fa-print"></i> Print Report
                  </button>
              </div>
          `;

          // Scroll to result
          window.scrollTo({ top: riskResult.offsetTop - 20, behavior: 'smooth' });

          // Add event listeners for buttons
          document.getElementById('new-assessment').addEventListener('click', () => {
              riskAssessmentForm.reset();
              riskResult.style.display = 'none';
              document.getElementById('prediction-history').style.display = 'none';
          });

          document.getElementById('print-assessment').addEventListener('click', () => {
              printRiskAssessment(result);
          });

          document.getElementById('save-assessment').addEventListener('click', () => {
              showAlert('Assessment saved successfully!', 'success');
          });
      }

      // Function to print the risk assessment
      function printRiskAssessment(result) {
          const printWindow = window.open('', '_blank');

          // Get patient name if available or use National ID
          const nationalId = document.getElementById('national-id').value;

          printWindow.document.write(`
              <!DOCTYPE html>
              <html>
              <head>
                  <title>Risk Assessment Report - MamaRisk</title>
                  <style>
                      body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
                      .header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
                      .risk-high { color: #e63946; }
                      .risk-medium { color: #e9c46a; }
                      .risk-low { color: #2a9d8f; }
                      table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                      table, th, td { border: 1px solid #ddd; }
                      th, td { padding: 12px; text-align: left; }
                      th { background-color: #f4f4f4; }
                      .footer { margin-top: 40px; font-size: 0.9em; text-align: center; }
                  </style>
              </head>
              <body>
                  <div class="header">
                      <h1>MamaRisk Assessment Report</h1>
                      <p>National ID: ${nationalId}</p>
                      <p>Assessment Date: ${new Date().toLocaleString()}</p>
                  </div>

                  <h2>Risk Classification: <span class="risk-${result.prediction.toLowerCase()}">${result.prediction} Risk</span></h2>
                  <p>Model Confidence: ${result.confidence}%</p>

                  <h3>Vital Signs</h3>
                  <table>
                      <tr>
                          <th>Measurement</th>
                          <th>Value</th>
                          <th>Normal Range</th>
                      </tr>
                      <tr>
                          <td>Age</td>
                          <td>${document.getElementById('age').value} years</td>
                          <td>-</td>
                      </tr>
                      <tr>
                          <td>Systolic BP</td>
                          <td>${document.getElementById('systolic-bp').value} mmHg</td>
                          <td>90-140 mmHg</td>
                      </tr>
                      <tr>
                          <td>Diastolic BP</td>
                          <td>${document.getElementById('diastolic-bp').value} mmHg</td>
                          <td>60-90 mmHg</td>
                      </tr>
                      <tr>
                          <td>Blood Sugar</td>
                          <td>${document.getElementById('blood-sugar').value} mmol/L</td>
                          <td>3.9-7.8 mmol/L (fasting)</td>
                      </tr>
                      <tr>
                          <td>Body Temperature</td>
                          <td>${document.getElementById('body-temp').value} °F</td>
                          <td>97.8-99.5 °F</td>
                      </tr>
                      <tr>
                          <td>Heart Rate</td>
                          <td>${document.getElementById('heart-rate').value} bpm</td>
                          <td>60-100 bpm</td>
                      </tr>
                  </table>

                  <h3>Recommendations</h3>
                  <p>${result.prediction === 'High' ?
                      'Immediate medical consultation is recommended. Monitor blood pressure regularly and watch for warning signs.' :
                      result.prediction === 'Medium' ?
                      'Increased vigilance needed. Plan for more frequent check-ups and monitor symptoms and vital signs.' :
                      'Continue with regular prenatal care. Maintain check-ups and follow nutrition and exercise guidelines.'
                  }</p>

                  <div class="footer">
                      <p>This report was generated by MamaRisk AI Assessment System. This assessment is not a substitute for professional medical advice.</p>
                      <p>For medical emergencies, please contact emergency services immediately.</p>
                  </div>
              </body>
              </html>
          `);

          printWindow.document.close();
          printWindow.focus();
          setTimeout(() => printWindow.print(), 500);
      }

      // Function to fetch prediction history
      async function fetchPredictionHistory(nationalId) {
          const historyCard = document.getElementById('prediction-history');
          const historyContent = document.getElementById('history-content');

          if (!historyCard || !historyContent) return;

          try {
              // In production, you'd fetch this from an API endpoint
              // For now, we'll simulate a fetch
              const response = await fetch(`${API_BASE}/patients/${nationalId}`);

              if (!response.ok) {
                  throw new Error('Failed to fetch patient data');
              }

              const patientData = await response.json();

              // Make sure prediction history exists and has items
              if (!patientData.prediction_history || patientData.prediction_history.length === 0) {
                  historyCard.style.display = 'none';
                  return;
              }

              // Sort predictions by date (newest first)
              const sortedHistory = [...patientData.prediction_history].sort((a, b) => {
                  return new Date(b.predicted_at) - new Date(a.predicted_at);
              });

              // Display the history (excluding the most recent one that's already shown)
              const historyItems = sortedHistory.slice(0, 5).map((item, index) => {
                  const date = new Date(item.predicted_at).toLocaleDateString();
                  const time = new Date(item.predicted_at).toLocaleTimeString();
                  const riskClass = item.risk ? item.risk.toLowerCase() : 'unknown';

                  return `
                      <div class="history-item" style="padding: 15px; border-bottom: 1px solid #eee;
                           ${index === 0 ? 'border-top: 1px solid #eee;' : ''}">
                          <div class="row">
                              <div class="col" style="min-width: 150px;">
                                  <strong>Date:</strong> ${date}<br>
                                  <strong>Time:</strong> ${time}
                              </div>
                              <div class="col">
                                  <strong>Risk Level:</strong> <span class="risk-${riskClass}">${item.risk || 'Unknown'}</span><br>
                                  <strong>Confidence:</strong> ${item.confidence}%
                              </div>
                              <div class="col">
                                  <button class="btn btn-sm btn-primary view-details-btn" data-index="${index}">
                                      <i class="fas fa-eye"></i> View Details
                                  </button>
                              </div>
                          </div>
                      </div>
                  `;
              }).join('');

              // Show the history card
              historyCard.style.display = 'block';
              historyContent.innerHTML = historyItems.length > 0 ?
                  historyItems :
                  '<p style="text-align: center; padding: 20px;">No previous assessments found.</p>';

              // Add event listeners to the view details buttons
              document.querySelectorAll('.view-details-btn').forEach(btn => {
                  btn.addEventListener('click', () => {
                      const index = parseInt(btn.dataset.index);
                      const historyItem = sortedHistory[index];

                      // Show a modal with details if needed
                      // For now, just scroll to top and show an alert
                      showAlert('Historical data loaded', 'info');

                      // Could also display this historical data in the main card
                      // or in a modal with more details
                  });
              });

          } catch (error) {
              console.error('Error fetching prediction history:', error);
              historyCard.style.display = 'none';

          // ============ Initialize the Dashboard ============

          // Start with Dashboard View
          showView('dashboard-view');

          // Refresh stats on click
          if (refreshStatsBtn) {
              refreshStatsBtn.addEventListener('click', () => {
                  fetchDashboardStats();
                  fetchRecentAssessments();
                  showAlert('Dashboard statistics refreshed', 'success');
              });
          }
      });
    </script>
  </body>
</html>

